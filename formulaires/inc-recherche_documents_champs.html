#SET{label_all,(#VAL{dei_belgique:tout}|_T)}
#SET{rubriques,#ARRAY{}}

<BOUCLE_rubriques(RUBRIQUES){id_parent =#ENV{rubrique}} {par num titre} {si #ENV{parent}|oui}>
	<B_articles_rubriques>
		#SET{rubriques,#GET{rubriques}|array_merge{#ARRAY{#TITRE,#ID_RUBRIQUE}}}
	<BOUCLE_articles_rubriques(ARTICLES) {recherche?} {id_rubrique}{id_mot?}{0,1}> </BOUCLE_articles_rubriques>
</BOUCLE_rubriques>

#SET{mots,#ARRAY{}}
<BOUCLE_mots(MOTS){id_groupe = 1} {par num titre}>
	<B_articles_mots>
	#SET{mots,#GET{mots}|array_merge{#ARRAY{#TITRE,#ID_MOT}}}
	<BOUCLE_articles_mots(ARTICLES) {id_mot}{recherche?}{id_rubrique IN #ENV{_rubriques}}{0,1}> </BOUCLE_articles_mots>
</BOUCLE_mots>

<ul class="editer-groupe">
	<li class="editer editer_recherche">
		<label for="recherche"><:info_rechercher_02:></label>
		<input type="[(#HTML5|?{search,text})]" class="search text" size="10" name="recherche" id="recherche"[ value="(#ENV{recherche})"] accesskey="4" autocapitalize="off" autocorrect="off"/>
	</li>
#SET{datas,#GET{rubriques}|array_flip}
[(#ENV{parent}|oui)
	[(#SAISIE{selection_multiple_recherche,rubriques,
		label=<:dei_belgique:label_categories:>,
		datas=#GET{datas},
		cacher_option_intro=oui,
		class=chosen
		})]
]

#SET{datas,#GET{mots}|array_flip}
[(#SAISIE{selection_multiple_recherche,mots,
	label=<:dei_belgique:label_themes:>,
	datas=#GET{datas},
	cacher_option_intro=oui,
	class=chosen
	})]
</ul>
<script type="text/javascript">
$(function() {
	$("#champ_rubriques").change(function(event) {
		variables();
		ajaxReload('recherche_champs', {
			args : {
				_rubriques : rubriques,
				rubriques : rubriques,
				id_mot : mots,
				mots : mots,
			}
		});
	});
	
	$("#champ_mots").change(function(event) {
		variables();
		ajaxReload('recherche_champs', {
			args : {
				_rubriques : rubriques,
				rubriques : rubriques,
				id_mot : mots,
				mots : mots,
			}
		});
	});
});

function variables(){
	rubriques = [];
	mots = [];
	$("option:selected", $('#champ_rubriques')).each(function() {
		rubriques.push($(this).val());
	});
	$("option:selected", $('#champ_mots')).each(function() {
		mots.push($(this).val());
	});	
	if (!jQuery.inArray('all', rubriques )) rubriques = [];
	if (!jQuery.inArray('all', mots )) mots = [];	
}
</script>
